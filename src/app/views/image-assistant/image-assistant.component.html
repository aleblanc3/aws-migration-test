<p-toast></p-toast>

<h1 id="wb-cont">{{ 'title.image' | translate }}</h1>
<p>{{ 'image.description' | translate }}</p>

<!-- API Key Status -->
<section class="api-key-status mb-4">
  <div>
    <strong>{{ 'page.apiKey.status' | translate }}</strong>
    <span *ngIf="apiKeyService.hasApiKey$ | async" class="text-green-600">
      <i class="pi pi-check-circle"></i> {{ 'page.apiKey.active' | translate }}
    </span>
    <span *ngIf="(apiKeyService.hasApiKey$ | async) === false" class="text-orange-600">
      <i class="pi pi-exclamation-circle"></i> {{ 'page.apiKey.notSet' | translate }}
    </span>
  </div>
</section>

<!-- Main Tool Area -->
<section>
  <!-- Model Selector -->
  <ca-shared-model-selector
    [selectedModel]="selectedVisionModel"
    [models]="visionModels"
    [label]="'image.model.label'"
    [cardTitle]="'image.model.title'"
    [showCard]="true"
    [showTranslateOption]="false"
    (modelChange)="onModelChange($event)">
  </ca-shared-model-selector>
  
  <!-- File Upload -->
  <ca-file-upload
    (filesSelected)="onFilesSelected($event)">
  </ca-file-upload>
  
  <!-- Progress Indicator -->
  <ng-container *ngIf="state$ | async as state">
    <ca-progress-indicator
      [progressText]="state.progressText"
      [processedCount]="state.processedCount"
      [totalFiles]="state.filesInProgress"
      [showProgress]="state.showProgressArea">
    </ca-progress-indicator>
    
    <!-- Results Display -->
    <div class="results-section" *ngIf="getResultsArray(state.results).length > 0">
      <ca-image-result 
        *ngFor="let result of getResultsArray(state.results)"
        [result]="result">
      </ca-image-result>
      
      <!-- CSV Download -->
      <ca-csv-download
        [results]="state.results">
      </ca-csv-download>
      
      <!-- Reset Button -->
      <div class="mt-3">
        <p-button 
          (click)="resetTool()"
          [label]="'image.reset.label' | translate"
          icon="pi pi-refresh"
          severity="secondary"
          [pTooltip]="'image.reset.tooltip' | translate">
        </p-button>
      </div>
    </div>
  </ng-container>
</section>