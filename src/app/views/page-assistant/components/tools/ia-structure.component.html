<!--UI-->
<div class="flex flex-row flex-wrap align-items-center gap-3 mt-0">
    <p-iftalabel>
        <p-inputnumber [(ngModel)]="depth" inputId="depth" mode="decimal" [showButtons]="true" [min]="2" [max]="6" />
        <label for="depth">Depth</label>
    </p-iftalabel>
    <p-button label="Verify IA" severity="help" (click)="checkIA()" [loading]="isChartLoading" icon="pi pi-info-circle" />
    <p-button label="Maximize IA chart" severity="secondary" (click)="maximize(chartContainer)" icon="pi pi-window-maximize" *ngIf="iaChart && iaChart.length > 0" />
</div>
<p-progressbar *ngIf="isChartLoading" [value]="iaProgress" [showValue]="false" [style]="{'height': '1rem'}" styleClass="mt-3" />

<!--Breadcrumb-->
<ng-container *ngIf="breadcrumb.length > 0">
    <h2>Breadcrumb</h2>
    <div class="flex flex-row align-items-center gap-3">
        <p-breadcrumb class="max-w-full" styleClass="pl-1" [model]="breadcrumb" />
        <span class="flex align-items-center gap-2 text-green-400" *ngIf="urlFound===true"><i class="pi pi-check-circle"></i>Link found on parent page</span>
        <span class="flex align-items-center gap-2 text-red-400" *ngIf="urlFound===false"><i class="pi pi-times-circle"></i>IA Orphan</span>
    </div>
</ng-container>

<!--IA Chart-->
<ng-container *ngIf="iaChart">
    <h2>IA structure</h2>
    <p *ngIf="iaChart.length === 0">No child pages found.</p>
    <div #chartContainer *ngIf="iaChart.length > 0" class="overflow-auto max-h-75vh surface-ground surface-border border-1 py-3 mb-3 ia-chart-container">
        <p-organization-chart [value]="iaChart">
            <ng-template let-node pTemplate="default">
                <p><a [href]="node.data.url" target="_blank" (click)="onNodeClick($event)" [innerHTML]="node.label" class="ia-label"></a></p>
            </ng-template>
        </p-organization-chart>
    </div>
</ng-container>

<!--IA Tree-->

<ng-container *ngIf="iaChart">
    <p-contextMenu #cm [model]="options"></p-contextMenu>
    <h2>IA structure tree</h2>
    <p-tree [value]="iaChart" styleClass="w-full md:w-[30rem]"
            [selectionMode]="selectable ? 'single' : null" [(selection)]="selectedNode"
            [draggableNodes]="draggable" [droppableNodes]="true" draggableScope="self" droppableScope="self" (onNodeDrop)="handleNodeDrop($event)"
            [contextMenu]="cm" (onNodeContextMenuSelect)="onNodeContextMenu($event)">
        <ng-template pTemplate="default" let-node>
            <div class="flex flex-row align-items-center gap-2 w-full">
                <i class="pi pi-folder" *ngIf="node.children.length > 0 && !draggable && !node.data.editing"></i>
                <i class="pi pi-file" *ngIf="(node.children.length === 0 || !node.children) && !draggable && !node.data.editing"></i>
                <i *ngIf="draggable" class="pi pi-arrows-alt cursor-move text-color-secondary"></i>
                <i *ngIf="node.data.editing" class="pi pi-pencil text-color-secondary"></i>
                <ng-container *ngIf="!node.data.editing"><a [href]="node.data.url" target="_blank" (click)="onNodeClick($event)" [innerHTML]="node.label" class="ia-label"></a></ng-container>
                <p-inputgroup *ngIf="node.data.editing === 'label'">
                    <input type="text" pInputText [(ngModel)]="node.label" pSize="small" class="ia-label" (keydown)="onInputKeydown($event)" />
                    <p-inputgroup-addon><p-button icon="pi pi-check" severity="secondary" size="small" (onClick)="saveNode()" /></p-inputgroup-addon>
                </p-inputgroup>
                <p-inputgroup *ngIf="node.data.editing === 'link'">
                    <input type="text" pInputText [(ngModel)]="node.data.url" pSize="small" class="ia-label" (keydown)="onInputKeydown($event)" />
                    <p-inputgroup-addon><p-button icon="pi pi-check" severity="secondary" size="small" (onClick)="saveNode()" /></p-inputgroup-addon>
                </p-inputgroup>
            </div>
        </ng-template>
    </p-tree>
</ng-container>

<!--IA Table-->
<ng-container *ngIf="iaChart">
    <h2>IA structure table</h2>
    <p-treeTable [value]="iaChart" styleClass="p-treetable-sm" [scrollable]="true">
        <ng-template #header>
            <tr>
                <th>H1</th>
                <th>URL</th>
            </tr>
        </ng-template>
        <ng-template #body let-rowNode let-rowData="rowData">
            <tr [ttRow]="rowNode">
                <td>
                    <p-treetable-toggler [rowNode]="rowNode" />
                    <span [innerHTML]="rowData.h1" class="ia-label"></span>
                </td>
                <td>{{ rowData.url }}</td>
            </tr>
        </ng-template>
    </p-treeTable>
</ng-container>

<!--Broken Links-->
<ng-container *ngIf="iaChart">
    <h2>Broken links</h2>
    <p *ngIf="brokenLinks.length === 0">No broken links found on this page<span *ngIf="iaChart[0].children?.length"> or on any detected child pages</span>.</p>
    <p-table *ngIf="brokenLinks.length > 0" [value]="brokenLinks" size="small" stripedRows [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template #header>
            <tr>
                <th>Parent page</th>
                <th>Broken link</th>
                <th>Status</th>
            </tr>
        </ng-template>
        <ng-template #body let-rowData>
            <tr>
                <td>{{ rowData.parentUrl }}</td>
                <td>{{ rowData.url }}</td>
                <td>{{ rowData.status }}</td>
            </tr>
        </ng-template>
    </p-table>
</ng-container>