<div class="metadata-assistant-container">
  <h1 id="wb-cont">{{ 'metadata.title' | translate }}</h1>
  <p>{{ 'metadata.description' | translate }}</p>

  <!-- API Key Status -->
  <section class="api-key-status mb-4">
    <div>
      <strong>{{ 'page.apiKey.status' | translate }}</strong>
      <span *ngIf="apiKeyService.hasApiKey$ | async" class="text-green-600">
        <i class="pi pi-check-circle"></i> {{ 'page.apiKey.active' | translate }}
      </span>
      <span *ngIf="!(apiKeyService.hasApiKey$ | async)" class="text-orange-600">
        <i class="pi pi-exclamation-circle"></i> {{ 'page.apiKey.notSet' | translate }}
      </span>
    </div>
  </section>

  <!-- Main Content Area -->
  <section *ngIf="apiKeyService.hasApiKey$ | async">
    <div class="row">
      <!-- Left Column: Input & Settings -->
      <div class="col-lg-6">
        <!-- URL Input -->
        <ca-url-input
          [disabled]="state.isProcessing"
          (urlsChange)="onUrlsChange($event)"
          (urlInputChange)="onUrlInputChange($event)">
        </ca-url-input>

        <!-- Model Selector with Translation Option -->
        <div class="mt-3">
          <ca-shared-model-selector
            [selectedModel]="state.selectedModel"
            [models]="models"
            [label]="'metadata.modelSelector.modelLabel'"
            [cardTitle]="'metadata.modelSelector.title'"
            [showCard]="true"
            [showTranslateOption]="true"
            [translateToFrench]="state.translateToFrench"
            [disabled]="state.isProcessing"
            (modelChange)="onModelChange($event)"
            (translateChange)="onTranslateToggle($event)">
          </ca-shared-model-selector>
        </div>

        <!-- Process Button -->
        <div class="mt-3">
          <p-button 
            [label]="state.isProcessing ? ('metadata.button.processing' | translate) : ('metadata.button.process' | translate)"
            icon="pi pi-sparkles"
            [disabled]="!canProcess()"
            [loading]="state.isProcessing"
            severity="primary"
            styleClass="w-full"
            (onClick)="startProcessing()">
          </p-button>
        </div>

        <!-- Reset Button -->
        <div class="mt-2" *ngIf="state.results.length > 0 && !state.isProcessing">
          <p-button 
            [label]="'metadata.button.reset' | translate"
            icon="pi pi-refresh"
            severity="secondary"
            [outlined]="true"
            styleClass="w-full"
            (onClick)="reset()">
          </p-button>
        </div>
      </div>

      <!-- Right Column: Progress & Error Messages -->
      <div class="col-lg-6">
        <!-- Progress Indicator -->
        <div *ngIf="state.isProcessing || state.currentStep === 'complete'">
          <ca-progress-indicator
            [progressText]="getProgressText()"
            [processedCount]="state.processedUrls"
            [totalFiles]="state.totalUrls"
            [showProgress]="true">
          </ca-progress-indicator>
        </div>

        <!-- Error Message -->
        <div *ngIf="state.error" class="mt-3">
          <p-message 
            severity="error" 
            [text]="state.error"
            styleClass="w-full">
          </p-message>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div class="results-section mt-4" *ngIf="state.results.length > 0">
      <!-- Metadata Results -->
      <ca-metadata-result
        [results]="state.results"
        [showTranslations]="state.translateToFrench">
      </ca-metadata-result>

      <!-- CSV Export -->
      <ca-metadata-csv-export
        [results]="state.results"
        [includeTranslations]="state.translateToFrench">
      </ca-metadata-csv-export>
    </div>
  </section>

  <!-- No API Key Message -->
  <div *ngIf="!(apiKeyService.hasApiKey$ | async)" class="mt-4">
    <p-message 
      severity="warn" 
      [text]="'metadata.errors.noApiKey' | translate"
      styleClass="w-full">
    </p-message>
  </div>
</div>