<div class="p-mb-3">
  <h1 class="p-text-bold">Translation Assistant</h1>
</div>

<div class="surface-100 border-round shadow-3 p-4 max-w-3xl mx-auto">
  <p-card class="p-mb-4">
    <h2 class="p-m-0 p-text-bold p-text-2xl" style="color: black">
      Upload source language file
    </h2>

    <p>
      Please upload a Word (.docx) or PowerPoint (.pptx) file containing your
      source language content.
    </p>

    <!-- Upload Section -->
    <div
      class="flex flex-column align-items-center justify-content-center p-3 border-dashed border-round border-200 surface-100 hover:surface-200 hover:border-primary-400 transition-colors transition-duration-300 cursor-pointer w-full max-w-30rem min-h-12rem"
      (click)="fileInput.click()"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
    >
      <input
        type="file"
        accept=".docx,.pptx"
        #fileInput
        style="display: none"
        (change)="onFileSelected($event)"
      />
      <ng-container *ngIf="selectedFile; else dragArea">
        <p class="text-xl text-center">
          <i
            *ngIf="isDocx(selectedFile)"
            class="pi pi-file-word text-blue-500 text-2xl mr-1"
          ></i>
          <fa-icon
            *ngIf="isPptx(selectedFile)"
            [icon]="faFilePowerpoint"
            class="text-orange-500 text-2xl mr-1"
          ></fa-icon>

          {{ selectedFile.name }}
        </p>
      </ng-container>
      <ng-template #dragArea>
        <i
          class="pi pi-upload border-2 border-circle border-300 p-3 text-3xl text-color-secondary mb-2 hover:bg-primary hover:text-white transition-colors transition-duration-300"
        ></i>
        <p class="m-0 text-center text-sm">
          Drag and drop .docx or .pptx source language file here.
        </p>
      </ng-template>
    </div>

    <div class="flex gap-2 mt-3">
      <button
        pButton
        type="button"
        label="Upload file"
        icon="pi pi-upload"
        class="p-button p-component p-button-primary"
        [disabled]="!selectedFile"
        (click)="previewSource()"
      ></button>
    </div>

    <!-- Preview Panel -->
    <div *ngIf="previewText" class="mt-3">
      <div
        class="p-panel p-component border-1 border-round surface-100"
        style="border-color: #00000023; font-size: 1rem"
      >
        <div
          class="p-panel-header d-flex justify-content-between align-items-center cursor-pointer"
          style="
            height: 4rem;
            padding: 0 1rem;
            display: flex;
            font-size: 1.2rem;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
            gap: 0.5rem;
            width: 100%;
          "
          (click)="isExpanded = !isExpanded"
        >
          <div class="d-flex align-items-center">
            <i
              class="pi"
              [ngClass]="{
                'pi-plus': !isExpanded,
                'pi-minus': isExpanded,
              }"
              style="margin-right: 0.5rem"
            ></i>
            <span class="p-panel-title font-semibold" style="color: black"
              >Preview source language file</span
            >
          </div>

          <button
            pButton
            type="button"
            class="p-button-text p-button-icon-only flex-shrink-0"
            title="Copy All"
            (click)="copyAll($event)"
            style="width: 3rem; height: 3rem"
          >
            <span class="pi pi-copy" style="font-size: 1.4rem"></span>
          </button>
        </div>

        <div
          *ngIf="isExpanded"
          class="p-panel-content p-mt-2"
          style="
            background-color: white;
            padding: 1rem;
            border-top: 1px solid #ccc;
          "
        >
          <span>{{ previewText }}</span>
        </div>
      </div>
    </div>
  </p-card>
</div>

<!-- Target Language Content Card -->
<div
  *ngIf="showSecondUpload"
  class="surface-100 border-round shadow-3"
  style="border: 2px solid #00000000; padding: 1rem"
>
  <p-card>
    <h2 class="p-mb-3" style="color: black">Paste target language content</h2>
    <p>
      Paste the full translation of the uploaded source content into the box
      below.
    </p>
    <textarea
      pInputTextarea
      rows="15"
      cols="70"
      placeholder=""
      class="p-inputtext p-mb-3 w-full"
      style="min-height: 10rem; resize: vertical text"
      [(ngModel)]="frenchText"
    ></textarea>

    <div class="flex gap-2 mt-3">
      <button
        pButton
        type="button"
        label="Format target language content"
        icon="pi pi-align-left"
        class="p-button-primary"
        (click)="onFormatTargetLanguageContent()"
      ></button>
    </div>
  </p-card>
</div>

<!-- Spinner and Generating Files Message -->
<div *ngIf="isProcessing" class="p-mt-4 text-center">
  <p-progressSpinner styleClass="p-mt-3"></p-progressSpinner>
  <p class="p-mt-2 font-bold">Generating files...</p>
</div>

<div
  *ngIf="showDownloadSection"
  class="surface-100 border-round shadow-3"
  style="border: 2px solid #00000000; padding: 1rem"
>
  <p-card>
    <h2 class="p-mb-3" style="color: black">Formatting complete</h2>
    <p>
      The translated file has been formatted to match the original layout and is
      ready for download.
    </p>
    <div class="flex gap-2 mt-3">
      <button
        pButton
        type="button"
        label="Download file"
        icon="pi pi-download"
        class="p-button-primary"
        (click)="onDownloadFile()"
      ></button>
    </div>
  </p-card>
</div>
